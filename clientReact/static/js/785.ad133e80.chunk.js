"use strict";(self.webpackChunkcheesReact=self.webpackChunkcheesReact||[]).push([[785],{785:(e,t,s)=>{s.r(t),s.d(t,{Board:()=>n});var i=s(951),r=s(166),o=s(362),a=s(403);console.log("start script with Board 17-09");class n{constructor(e){let{styles:t,globalState:s}=e;if(this.globalState=void 0,this.setGlobalState=void 0,this.enemyHighlight=void 0,this.figures=void 0,this.turn=void 0,this.figurePositions=void 0,this.movesHistory=void 0,this.boardFlipMode=void 0,this.score=void 0,this.activeFigure=void 0,this.styles=void 0,this.placeNewWhiteFigure=void 0,this.placeNewBlackFigure=void 0,this.chessDesk=void 0,this.historyHTML=void 0,this.turnSpan=void 0,this.newGameBtn=void 0,this.saveListHTML=void 0,this.players=void 0,this.playerNames=void 0,this.cages=void 0,window.state=this,this.globalState=null===s||void 0===s?void 0:s.globalState,this.setGlobalState=null===s||void 0===s?void 0:s.setGlobalState,this.enemyHighlight=!1,this.figures=[],this.turn=["black",""],this.figurePositions={},this.movesHistory=[],this.boardFlipMode=!1,this.score={white:39,black:39},this.activeFigure=null,this.styles=t||{},this.chessDesk=document.querySelector("#chessDesk"),this.historyHTML=document.querySelector("#history"),this.turnSpan=document.querySelector(".turnSpan"),this.newGameBtn=document.querySelector(".newGameBtn"),this.saveListHTML=document.querySelector(".saves"),this.players=document.querySelectorAll("."+this.styles.player),this.playerNames={white:"player1",black:"player2"},this.playerNames.white=this.globalState.userName,this.turn[1]=this.playerNames[this.turn[0]],this.changeTurn(),this.placeNewWhiteFigure=this.addNewFigureFactory("white"),this.placeNewBlackFigure=this.addNewFigureFactory("black"),!this.chessDesk)throw new Error("\u041d\u0435 \u0445\u0432\u0430\u0442\u0430\u0435\u0442 \u0445\u0442\u043c\u043b-\u044d\u043b\u043c\u0435\u043d\u0442\u043e \u0432 \u0414\u041e\u041c \u0434\u043b\u044f \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u0441\u043a\u0440\u0438\u043f\u0442\u0430");this.cages=Array.from(this.chessDesk.querySelectorAll(".chessDeskCage")),this.initBoard()}getFigureByCoord(e){return this.figures.find((t=>t.coord==e))}placeAllFigures(e,t){e.forEach((e=>{let[t,s]=e;this.placeNewWhiteFigure(t,s)})),t.forEach((e=>{let[t,s]=e;this.placeNewBlackFigure(t,s)}))}startBoard(){this.refreshMenu(),this.refreshScore(),this.refreshPlayers(),this.startGame(i.l,i.t)}initBoard(){var e;let t=0;for(let s=8;s>0;s--)for(let e=0;e<8;e++)this.cages[t].dataset.cageName=o.m[e]+s,t++;null===(e=document.getElementById("chessDesk"))||void 0===e||e.addEventListener("click",(e=>{const t=e.target.closest("."+this.styles.chessDeskCage),s=null===t||void 0===t?void 0:t.dataset.cageName,i=this.activeFigure;if(!s||!i)return;const r=i.moves.find((e=>e.coord===s));if(r&&i.isActive&&this.figures.includes(i)&&("move"===r.type||"castling"===r.type)){if("castling"===r.type){const e="g"===s[0],t="white"===i.color?1:8;let[r,o]=e?["h","f"]:["a","d"];const a=r+t,n=this.figures.find((e=>e.coord===a&&!e.wasMoved));if(!n)return;n.place(o+t)}i.place(s),i.figure.classList.remove("active"),i.isActive=!1,this.activeFigure=null,this.changeTurn(),this.chessDesk.removeEventListener("click",r)}})),this.addHandlersToNewGameBtn()}destroyBoard(){console.log("destroy board 2"),this.refreshMenu(),this.refreshScore(),this.refreshPlayers(),this.removeAllFigures()}invokeConfirmationModal(){return new Promise(((e,t)=>{const s=document.createElement("div");s.classList.add(this.styles.confirmModal),s.innerHTML=`\n            <h3>\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c?</h3>\n            <div class="${this.styles.confirmAnswers}">\n            <div class="${this.styles.yesBtn} ${this.styles.btn}">\u0414\u0430</div><div class="${this.styles.noBtn} ${this.styles.btn}">\u041d\u0435\u0442</div>\n            </div>\n            `;const i=s.querySelector("."+this.styles.yesBtn),r=s.querySelector("."+this.styles.noBtn);document.body.append(s),i&&i.addEventListener("click",(()=>{e(!0),s.remove()})),r&&r.addEventListener("click",(()=>{e(!1),s.remove()}))}))}addHandlersToPlayers(){if(this.players)for(let e of this.players){const t=e.querySelector(".enterNewName"),s=e.querySelector(".nameInput"),i=e.querySelector(".name"),r=e.querySelector(".changeBtn"),o=e.querySelector(".exitBtn");function a(){t&&t.classList.remove(this.styles.hide),s&&s.classList.add(this.styles.hide),r&&r.classList.add(this.styles.hide),o&&o.classList.add(this.styles.hide),s&&(s.value="")}t&&t.addEventListener("click",(()=>{t.classList.add(this.styles.hide),s&&s.classList.remove(this.styles.hide),r&&r.classList.remove(this.styles.hide),o&&o.classList.remove(this.styles.hide),r&&r.addEventListener("click",(()=>{s&&s.value.length>0&&(i&&(i.textContent=s.value),this.playerNames[e.classList[1]]=s.value,a.bind(this)())})),o&&o.addEventListener("click",a.bind(this))}))}}clearNames(){for(let e of this.players){const t=e.querySelector(".name");t&&(t.textContent="")}}refreshPlayers(){for(let e of this.players){const t=e.classList[1].split("_")[1],s=e.querySelector(".name");s&&(s.textContent=this.playerNames[t]);const i=e.querySelector(".score");i&&(i.textContent=this.score[t])}}addHandlersToNewGameBtn(){this.newGameBtn&&this.newGameBtn.addEventListener("click",(()=>{this.invokeConfirmationModal().then((e=>{e&&this.startGame(i.l,i.t)}))}))}addHandlersToLoadBtns(){if(this.saveListHTML)for(let s of this.saveListHTML.querySelectorAll("."+(null===(e=this.styles)||void 0===e?void 0:e.save))){var e,t;if(!s)return;const o=s.querySelector("."+this.styles.id).textContent,a=this.getSavesFromLocalStorage().find((e=>e.id==o));s.addEventListener("click",(()=>{this.invokeConfirmationModal().then((e=>{if(e){var t,n;if(s.classList.contains(null!==(t=null===(n=this.styles)||void 0===n?void 0:n.readOnly)&&void 0!==t?t:"readOnly")){const e={whiteFigures:i.l,blackFigures:i.t,movesHistory:a.movesHistory};return review.removeAllFigures(),review=new r.p(e.movesHistory,e.whiteFigures,e.blackFigures,this.styles),void review.startReview()}o&&this.loadFromLocalStorage(o)}}))})),null===(t=s.querySelector("."+this.styles.deleteSaveBtn))||void 0===t||t.addEventListener("click",(e=>{e.stopPropagation(),this.invokeConfirmationModal().then((e=>{e&&o&&this.removeSaveFromLocalStorage(o),this.refreshMenu()}))}))}}addHandlersToSaveBtns(){for(let e of document.querySelectorAll("."+this.styles.emptySaveCage))e.addEventListener("click",(e=>{const t=e.target;t&&state.saveToLocalStorage(t.dataset.id),this.refreshMenu()}))}displaySaves(){const e=this.getSavesFromLocalStorage();function t(e){const t=document.createElement("div");t.classList.add(this.styles.emptySaveCage),t.textContent="\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",t.dataset.id=e,this.saveListHTML.append(t)}function s(e){const t=document.createElement("div");t.classList.add(this.styles.save),t.innerHTML=`<span class="${this.styles.id}">${e.id}</span> <span class="${this.styles.moveCount}">${e.movesHistory.length} \u0445\u043e\u0434\u043e\u0432</span><div class="${this.styles.deleteSaveBtn}"><img src="img/deleteIcon.png"></div>`,"read"==e.mode&&(t.classList.add(this.styles.readOnly),t.innerHTML=`<span class="${this.styles.id}">${e.id}</span><img class="${this.styles.readOnlyIcon}" src="img/readOnlyIcon.png"> <span class="${this.styles.moveCount}">${e.movesHistory.length} \u0445\u043e\u0434\u043e\u0432</span><div class="${this.styles.deleteSaveBtn}"><img src="img/deleteIcon.png"></div>`),this.saveListHTML.append(t)}this.saveListHTML&&(this.saveListHTML.innerHTML="");for(let i=1;i<=4;i++){const r=e.find((e=>e.id==i));r?s.call(this,r):t.call(this,i)}}getSavesFromLocalStorage(){let e;return localStorage.getItem("saves")&&(e=JSON.parse(localStorage.getItem("saves"))),e||(localStorage.setItem("saves","[]"),e=[]),e}saveToLocalStorage(e){const t=this.getSavesFromLocalStorage();t.length>=4?console.warn("\u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0439. \u0423\u0434\u0430\u043b\u0438\u0442\u0435 \u043e\u0434\u043d\u043e \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435, \u0447\u0442\u043e\u0431\u044b \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u044c!"):(t.find((t=>t.id==e))||t.push({id:e,mode:"game",figurePositions:this.figurePositions,movesHistory:this.movesHistory,turn:this.turn[0],playerNames:this.playerNames}),localStorage.setItem("saves",JSON.stringify(t)))}saveForReview(){const e=this.getSavesFromLocalStorage();if(e.length>=4)return void console.warn("\u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0439. \u0423\u0434\u0430\u043b\u0438\u0442\u0435 \u043e\u0434\u043d\u043e \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435, \u0447\u0442\u043e\u0431\u044b \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u044c!");let t=0;for(let s=1;s<=4;s++)if(!e.find((e=>e.id==s))){t=s;break}e.find((e=>e.id==t))||(e.push({id:t,mode:"read",movesHistory:this.movesHistory,turn:this.turn[0]}),localStorage.setItem("saves",JSON.stringify(e))),this.startGame(i.l,i.t)}loadFromLocalStorage(e){this.removeAllFigures();const t=this.getSavesFromLocalStorage().find((t=>t.id==e));this.applyState(t)}cleanLocalStorage(){localStorage.setItem("saves","[]")}removeSaveFromLocalStorage(e){const t=this.getSavesFromLocalStorage();t.splice(t.findIndex((t=>t.id==e)),1),localStorage.setItem("saves",JSON.stringify(t))}applyState(e){var t;if(review&&(null===(t=review.reviewBtns)||void 0===t||t.classList.add("hide")),review&&review.removeAllFigures(),this.cleanHistoyHTML(),this.movesHistory=[],this.changeTurnToColor(e.turn),e){this.playerNames=e.playerNames,this.refreshPlayers();for(let t of e.movesHistory)this.addHistoryPoint(t);for(let t in e.figurePositions){const s=e.figurePositions[t];"white"==s.color?this.placeNewWhiteFigure(s.type,t):this.placeNewBlackFigure(s.type,t)}}}transformFigure(e,t){e.deleteFigure(),this.addNewFigureFactory(e.color)(t,e.coord),this.refreshScore()}refreshMenu(){this.displaySaves(),this.addHandlersToLoadBtns(),this.addHandlersToSaveBtns(),this.addHandlersToPlayers()}addHistoryPoint(e){this.movesHistory.push(e);const t=document.createElement("div");t.classList.add(this.styles.historyPoint),t.innerHTML=`<span class="${this.styles.moveNum}">${this.movesHistory.length}.</span>\n        <img src="/img/${e.figureType.toLowerCase()}.png" class="${this.styles.figureImg} ${this.styles[e.color]}">\n        <span class="${this.styles.moves}">${e.prev}-${e.current}</span>`,this.historyHTML&&this.historyHTML.append(t)}changeTurnToColor(e){"white"!=e&&"black"!=e||(this.turnSpan&&this.turnSpan.classList.remove(this.turn[0]),this.turn[0]=e,this.turn[1]=this.playerNames[this.turn[0]],this.turnSpan&&this.turnSpan.classList.add(this.turn[0]),this.turnSpan&&(this.turnSpan.textContent=o.A[e]+`(${this.turn[1]})`))}changeTurn(){if(!this.turnSpan)return;this.turnSpan.classList.remove(this.turn[0]);const e="white"===this.turn[0]?"black":"white";this.turnSpan.classList.add(e),this.turn[0]=e,this.turn[1]=this.playerNames[this.turn[0]],this.turnSpan.textContent=o.A[e]+`(${this.turn[1]})`,this.boardFlipMode&&content&&content.classList.toggle("flip")}removeAllFigures(){if(0==this.figures.length)return;let e=this.figures.length-1;for(;e>=0;){const t=this.figures[e];e--,"King"!=t.type?t.deleteFigure():t.deleteFigure("init")}}endGame(){var e,t,s,r,a,n,l,h,d,c,v;const u=document.querySelector(".gameWrapper");if(!u)return;this.cleanHistoyHTML(),u.classList.add(null!==(e=null===(t=this.styles)||void 0===t?void 0:t.hide)&&void 0!==e?e:"hide");const y=document.createElement("div");null!==(s=this.styles)&&void 0!==s&&s.endGameModal&&y.classList.add(this.styles.endGameModal),y.innerHTML=`\n            <h3>\u041a\u043e\u043d\u0435\u0446 \u0438\u0433\u0440\u044b!</h3>\n            <p>\u041f\u043e\u0431\u0435\u0434\u0438\u043b\u0438 ${o.A[this.turn[0]]}</p>\n        `;const m=document.createElement("div");m.classList.add(null!==(r=null===(a=this.styles)||void 0===a?void 0:a.newGameBtn)&&void 0!==r?r:"newGameBtn",null!==(n=null===(l=this.styles)||void 0===l?void 0:l.btn)&&void 0!==n?n:"btn"),m.textContent="\u041d\u043e\u0432\u0430\u044f \u0438\u0433\u0440\u0430",m.addEventListener("click",(()=>{var e,t;state.startGame(i.l,i.t),y.remove(),u.classList.remove(null!==(e=null===(t=this.styles)||void 0===t?void 0:t.hide)&&void 0!==e?e:"hide")}));const g=document.createElement("div");g.classList.add(null!==(h=null===(d=this.styles)||void 0===d?void 0:d.saveForReviewBtn)&&void 0!==h?h:"saveForReviewBtn",null!==(c=null===(v=this.styles)||void 0===v?void 0:v.btn)&&void 0!==c?c:"btn"),g.textContent="\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0434\u043b\u044f \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0430",g.addEventListener("click",(()=>{var e,t;this.saveForReview(),this.refreshMenu(),y.remove(),u.classList.remove(null!==(e=null===(t=this.styles)||void 0===t?void 0:t.hide)&&void 0!==e?e:"hide")})),y.append(m,g),content&&content.prepend(y),y.append(g),content&&content.prepend(y)}addNewFigureFactory(e){return function(t,s){if(!Object.keys(a.D8).includes(t))return;let i;return i=new a.D8[t](e,this.cages,this.styles),i.place(s,!0),i}.bind(this)}refreshScore(){const e={white:39,black:39};let t=0;for(;t<this.figures.length;){const s=this.figures[t];t++,s.cost&&("white"==s.color?e.black-=s.cost:e.white-=s.cost)}this.score=e}startGame(e,t){var s,i,r,o;review&&(null===(r=review.reviewBtns)||void 0===r||r.classList.add(null===(o=this.styles)||void 0===o?void 0:o.hide),review.removeAllFigures());state.removeAllFigures(),this.movesHistory=[],this.score={white:0,black:0};const a=document.getElementById("content");null===a||void 0===a||a.classList.remove(null!==(s=null===(i=this.styles)||void 0===i?void 0:i.hide)&&void 0!==s?s:"hide"),this.placeAllFigures(e,t),this.cleanHistoyHTML(),this.changeTurnToColor("white")}cleanHistoyHTML(){this.historyHTML&&(this.historyHTML.innerHTML="")}}}}]);
//# sourceMappingURL=785.ad133e80.chunk.js.map